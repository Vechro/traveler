---
import Layout from "~/layouts/Layout.astro";
---

<script>
  import { getAuth, getPostgrestWithSession } from "~/utilities/api";
  import { UnreachableError } from "~/utilities/UnreachableError";

  const auth = getAuth();

  const {
    data: { user, session },
    error,
  } = await auth.refreshSession();
  if (!user || !session || error) {
    console.error(error);
    window.location.pathname = "/sign-in";
    throw new UnreachableError();
  } else {
    import("~/components/globe-viewer");

    const rest = getPostgrestWithSession(session);
    rest
      .from("profiles")
      .select("*")
      .match({ id: user.id })
      .then(console.log);
  }
</script>
<Layout title="Globe">
  <globe-viewer />
</Layout>
